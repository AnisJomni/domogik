{% extends "layout_admin.html" %}
{% comment %}
# Copyright 2008 Domogik project

# This file is part of Domogik.
# Domogik is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# Domogik is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with Domogik.  If not, see <http://www.gnu.org/licenses/>.

# Author : Cédric Trévisan <cedric@domogik.org> {% endcomment %}


{% load i18n %}
{% block css %}
    <link href="/design/skins/{{ request.session.user.skin_used|default:'default' }}/css/dmg-dragdrop.css" rel="stylesheet" type="text/css" />
    <link href="/design/skins/{{ request.session.user.skin_used|default:'default' }}/css/ui-tables.css" rel="stylesheet" type="text/css" />
    <link href="/design/skins/{{ request.session.user.skin_used|default:'default' }}/css/page-admin-organization.css" rel="stylesheet" type="text/css" />
    <link href="/design/skins/{{ request.session.user.skin_used|default:'default' }}/css/dmg.collabsible-list.css" rel="stylesheet" type="text/css" />
    <link href="/design/skins/{{ request.session.user.skin_used|default:'default' }}/css/fg.menu.css" rel="stylesheet" type="text/css" />
    <link href="/design/skins/{{ request.session.user.skin_used|default:'default' }}/css/ui-action-binary.css" rel="stylesheet" type="text/css" />
    <link href="/design/skins/{{ request.session.user.skin_used|default:'default' }}/css/ui-action-range.css" rel="stylesheet" type="text/css" />
{% endblock %}
{% block js_include %}
    <script type="text/javascript" src="/design/js/dmg.dragdrop-complex.js"></script>
    <script type="text/javascript" src="/design/js/fg.menu.js"></script>
    <script type="text/javascript" src="/design/js/ui.action-binary.js"></script>
    <script type="text/javascript" src="/design/js/ui.action-range.js"></script>
{% endblock %}
{% block js_script %}
    $(function(){
        // Accordion
        $("#nav2").accordion({ autoHeight: false, header: ".subnav2", active:0});
        
        $("#tabsfeatures").tabs();        
        $("#tabsassociations").tabs();
        
        /* Drag & Drop */
        $('#dragdropfeatures').dragdrop({
            target: ".targetdrop",
            choice: "legend",
            featurename : ".name",
            dropcallback: function(self, element, target) {
//                alert(element + " -> " + target);
            }
        });

        $('#dragdropfeatures').dragdrop('addzones', {
            id: "#tabsfeatures",
            drag: true,
            drop: false,
            droporigin : true,
            keeptrace: true
        });

        $('#dragdropfeatures').dragdrop('addzones', {
            id : "#tabsassociations",
            drag: true,
            drop: true,
            droporigin : false,
            keeptrace: false
        });

    });
{% endblock %}
{% block title %}{% trans page_title %}{% endblock %}

{% block banner %}
    <h1 class="ident"><span class="title">{% trans page_title %}</span></h1>
    {% ifnotequal status "" %}
    <div id='messages' class='{{status}}'>{{msg}}</div>
    {% endifnotequal %}
{% endblock %}

{% block right %}
    <section class="subsection">
        <div id="dragdropfeatures"/>
        <h2>{% trans "Features list" %}</h2>
        <div id="tabsfeatures">
            {% spaceless %}
            <ul>
                {% regroup devices_list|dictsort:"deviceusage" by deviceusage as usages_list %}
                {% for usage in usages_list %}
                    {% if usage.grouper.id %}
                        <li><a id="tab{{ usage.grouper.id }}" href="#element{{ usage.grouper.id }}" class="icon16-usage-{{ usage.grouper.id }}">{{ usage.grouper.name }}</a></li>
                    {% endif %}
                {% endfor %}
            </ul>
            {% endspaceless %}
            {% regroup devices_list|dictsort:"deviceusage" by deviceusage as usages_list %}
            {% for usage in usages_list %}
                <div id="element{{ usage.grouper.id }}" class="tabelement">
                    {% for device in usage.list %}
                        <fieldset class="targetdrop" value='device-{{ device.id }}'>
                            <script type="text/javascript">
                            // <![CDATA[
                                $(function() {
                                    $("#command_{{ device.id }}_1").binary_widget_core({
                                        usage: 1,
                                        isCommand: false
                                    });
                                    $("#command_{{ device.id }}_2").range_widget_core({
                                        usage: 1,
                                        isCommand: false
                                    });
                                });
                            // ]]>
                            </script>
                            <legend>{{ device.name }} ({{ device.address }})</legend>
                            <ul class="draggables">
                                <li class="draggable" value="feature-{{ device.id }}_1"><div id="command_{{ device.id }}_1"><span class='name'>{{ device.name }}<br/>Test 1</span></div></li>
                                <li class="draggable" value="feature-{{ device.id }}_2"><div id="command_{{ device.id }}_2"><span class='name'>{{ device.name }}<br/>Test 2</span></div></li>
                            </ul>
                        </fieldset>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
        <h2>{% trans "Associations" %}</h2>
        <div id="tabsassociations">
            {% spaceless %}
            <ul>
                <li><a id="tabhouse" href="#elementhouse" class="">{% trans "House" %}</a></li>
                <li><a id="tabareas" href="#elementareas" class="">{% trans "Areas" %}</a></li>
                <li><a id="tabrooms" href="#elementrooms" class="">{% trans "Rooms" %}</a></li>
            </ul>
            {% endspaceless %}
            <div id="elementhouse" class="tabelement">
                <fieldset class="targetdrop" value='house-0'>
                    <legend class="choice icon16-house-default">{{ house.name }}</legend>
                    <ul class="draggables"></ul>
                </fieldset>
            </div>
            <div id="elementareas" class="tabelement">
                {% for area in areas_list %}
                <fieldset class="targetdrop" value='area-{{ area.id }}'>
                    <legend class="choice icon16-area-{{ area.config.icon }}">{{ area.name }}</legend>
                    <ul class="draggables"></ul>
                </fieldset>
                {% endfor %}
            </div>
            <div id="elementrooms" class="tabelement">
                {% for room in rooms_list %}
                <fieldset class="targetdrop" value='room-{{ room.id }}'>
                    <legend class="choice icon16-room-{{ room.config.icon }}">{{ room.name }}</legend>
                    <ul class="draggables"></ul>
                </fieldset>
                {% endfor %}
            </div>
        </div>
    </section>
{% endblock %}
