
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>&lt;no title&gt; &mdash; Domogik 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Domogik 0.1 documentation" href="../../index.html" />
    <link rel="next" title="&lt;no title&gt;" href="../wol_ping/index.html" />
    <link rel="prev" title="&lt;no title&gt;" href="../plcbus/index.html" /> 
  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Domogik 0.1 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
      </div>
      <div class="nav">
    &laquo; <a href="../plcbus/index.html" title="&amp;lt;no title&amp;gt;">previous</a> 
     |
    <a title="Domogik 0.1 documentation" href="../../index.html" accesskey="U">up</a>
   |
    <a href="../wol_ping/index.html" title="&amp;lt;no title&amp;gt;">next</a> &raquo;</div>
    </div>
    
    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="plugins-teleinfo-index">
            
  <p>{maketoc}</p>
<p>!Purpose
Teleinformation is a protocol used by a French power provider.
The electric meter sends information on a special bus.</p>
<p>With some custom PCB, you can read this information and keep/log/study your power consumption.
The PCB [<a class="reference external" href="http://teleinfo.dauguet.net/articles.php">http://teleinfo.dauguet.net/articles.php</a>?lng=fr&amp;pg=44|is available here]. Some other &#8220;teleinfo modem&#8221; are available elsewhere on the net.</p>
<p>Models supported by plugin :
* Dauguet USB Teleinfo modem
* Dauguet Seriel Teleinfo modem</p>
<p>Others modem could be supported by plugin. Feel free to test them with this plugin and report us :)</p>
<p>!!Interesting links about Teleinfo
* (fr) <a class="reference external" href="http://www.planete-domotique.com/blog/2010/03/30/la-teleinformation-edf/">http://www.planete-domotique.com/blog/2010/03/30/la-teleinformation-edf/</a>
* (fr) <a class="reference external" href="http://bernard.lefrancois.free.fr/teleinfo.htm">http://bernard.lefrancois.free.fr/teleinfo.htm</a></p>
<p>!Known issues
Actually the plugin support only one teleinfo modem. In a futur release, it will support several teleinfo modem.</p>
<p>!Prerequisites
!!Dependancies - Ubuntu/Debian installation
To use Plcbus plugin, you need python serial package. To install it, launch this command :
{CODE()}
sudo apt-get install python-serial
{CODE}</p>
<p>!How to plug</p>
<p>!!Example with Dauguet Usb model
First, you should have an electric meter like this :
{IMG(attId=&#8221;86&#8221;)}{IMG}</p>
<p>Open the bottom part (be careful, if there is a metallic security to prevoid opening, you may be looking for the wrong thing!!) of the electric meter. On the right, you should see <strong>I1</strong> and <strong>I2</strong> : it is there you should plug the teleinfo modem. On this photo, there are both a teleinfo modem and a heating programmer pluged.
{IMG(attId=&#8221;87&#8221;)}{IMG}</p>
<p>Here is the Usb teleinfo modem : on the left, the usb plug, on the right, the 2 wires that are plugged on I1 and I2 :
{IMG(attId=&#8221;85&#8221;)}{IMG}</p>
<p>!!Permissions management
By default, you need to be root to access teleinfo modem. To give access to everybody on your computer to the teleinfo modem, follow these instructions.</p>
<p>Create an udev rule for teleinfo in file <strong>/etc/udev/rules.d/teleinfo.rules</strong> :
!!!Moschip usb-&gt;serial adapter.
If you use a usb to serial adapter (modship model) with a serial Teleinfo modem, you can use this rule :
{CODE()}
KERNEL==&#8221;ttyUSB*&#8221;, ATTRS{port_number}==&#8221;0&#8221;, DRIVERS==&#8221;moschip7720&#8221;, SYMLINK+=&#8221;teleinfo&#8221;, MODE=&#8221;0666&#8221;
{CODE}</p>
<p>!!!Dauguet usb assemby
Available on [<a class="reference external" href="http://teleinfo.dauguet">http://teleinfo.dauguet</a>.net|http://teleinfo.dauguet.net] : Usb model.
{CODE()}
SUBSYSTEMS==&#8221;usb&#8221;, ATTRS{idVendor}==&#8221;0403&#8221;, ATTRS{idProduct}==&#8221;6001&#8221;, SYMLINK+=&#8221;teleinfo&#8221;, MODE=&#8221;0666&#8221;
{CODE}</p>
<p>!!!Other assemblies
<em>Feel free to give us your teleinfo modem model and udev rules ;)</em></p>
<p>!!!!Example for an usb model
First, get vendor and product ids with <strong>lsusb</strong> command :
{CODE()}
# lsusb
Bus 006 Device 013: ID 0123:4567 Some bla bla
{CODE}
Here, vendor id is 0123and product id is 4567.</p>
<p>The rule will be :
{CODE()}
SUBSYSTEMS==&#8221;usb&#8221;, ATTRS{idVendor}==&#8221;0123&#8221;, ATTRS{idProduct}==&#8221;4567 &#8221;, SYMLINK+=&#8221;teleinfo&#8221;, MODE=&#8221;0666&#8221;
{CODE}</p>
<p>!!!Apply the rule
You just have to unplug and plug back your Teleinfo modem to have permissions on it as a non root user. Your Teleinfo modem device will have <strong>/dev/teleinfo</strong> as entry point</p>
<p>!!!Check the device under Linux
Setup the connection according to the Teleinfo specifications
{CODE()}
# stty -F /dev/teleinfo 1200 sane evenp parenb cs7 -crtscts
{CODE}</p>
<p>Display the data flow
{CODE()}
# cat /dev/teleinfo
ADCO 012345678901 =
OPTARIF HC.. &lt;
ISOUSC 60 &lt;
HCHC 009205446 $
HCHP 011101473 %
PTEC HP..
IINST 002 Y
IMAX 047 J
PAPP 00520 (
HHPHC D /
MOTDETAT 000000 B
...
{CODE}
!Plugin configuration
!!Enabling plugin
You can enable plugin by using :
{CODE()}
dmgenplug teleinfo
{CODE}</p>
<p>You just have to reload administration page to see the plugin in the list.</p>
<p>!!Configuration
In Domogik administration, go to teleinfo configuration page.</p>
<p>!!!device
This is the address of Teleinfo modem device. If you follow previsous instructions about permissions, it should be <strong>/dev/teleinfo</strong>. Elsewhere, it could be something like <strong>/dev/ttyUSB0</strong> for an usb model.
Default : /dev/teleinfo</p>
<p>!!!interval
This is the time between each read of modem teleinfo for getting data.
Default : 60</p>
<p>!!Start plugin
You can now start the plugin (start button).</p>
<p>!Creating a device for Teleinfo modem
In administration, go to <strong>Organization &gt; Devices</strong> page. Create a new device like this :
* Name : &#8220;Teleinformation&#8221; or whatever you want
* Description : some description
* Address : &#8220;teleinfo&#8221; (don&#8217;t change this value)
* Reference : &#8220;Dauguet usb model&#8221; or whatever you want
* Usage : &#8220;Service.Teleinfo&#8221;
* Type : &#8220;Electricity&#8221;</p>
<p>Example :</p>
<p>{IMG(attId=&#8221;192&#8221;)}{IMG}</p>
<p>Several features are available :
* Maximum power
* Instant power
* Off peak hours
* Peak hours
* Tariff period
* Apparent power
* Hourly group</p>
<p>((Setup_your_devices|Attribute the features to a place. You now have access to your electricity informations)).</p>
<p>!Helpers
<em>To get an introduction to helpers, you can read the ((Plugins_helpers|Helper documentation)). To use a helper, the plugin must be stopped.</em></p>
<p>!!teleinfo read &lt;device&gt;
<strong>teleinfo read &lt;device&gt;</strong> will read current data on electric meter and display them. Example :</p>
<p>{CODE()}
$ teleinfo read /dev/teleinfo
Electric meter data :
ADCO       : 030928084432
OPTARIF    : HC..
ISOUSC     : 45
HCHC       : 005809449
HCHP       : 006852296
PTEC       : HP..
IINST      : 004
IMAX       : 048
PAPP       : 00860
HHPHC      : D
MOTDETAT   : 000000
{CODE}
!Teleinfo data explanation
<em>Note : this plugin is only related to french people, so following data has no interest to be translated.</em>
||**Tag**    <a href="#id1"><span class="problematic" id="id2">|**Format**             |**Description**
ADCO       |12 car.                | N° d&#8217;identification du compteur
OPTARIF    |4 car.                 | Option tarifaire (type d&#8217;abonnement)
ISOUSC     |2 car. unité = ampères | Intensité souscrite
BASE       |9 car. unité = Wh      | Index si option = base
HCHC       |9 car. unité = Wh      | Index heures creuses si option = heures creuses
HCHP       |9 car. unité = Wh      | Index heures pleines si option = heures creuses
EJP HN     |9 car. unité = Wh      | Index heures normales si option = EJP
EJP HPM    |9 car. unité = Wh      | Index heures de pointe mobile si option = EJP
BBR HC JB  |9 car. unité = Wh      | Index heures creuses jours bleus si option = tempo
BBR HP JB  |9 car. unité = Wh      | Index heures pleines jours bleus si option = tempo
BBR HC JW  |9 car. unité = Wh      | Index heures creuses jours blancs si option = tempo
BBR HP JW  |9 car. unité = Wh      | Index heures pleines jours blancs si option = tempo
BBR HC JR  |9 car. unité = Wh      | Index heures creuses jours rouges si option = tempo
BBR HP JR  |9 car. unité = Wh      | Index heures pleines jours rouges si option = tempo
PEJP       |2 car.                 | Préavis EJP si option = EJP (30mn avant période EJP)
PTEC       |4 car.                 | Période tarifaire en cours
DEMAIN     |                       | Couleur du lendemain si option = tempo
**IINST**  |3 car. unité = ampères | Intensité instantanée
ADPS       |3 car. unité = ampères | Avertissement de dépassement de puissance souscrite (message émis uniquement en cas de dépassement effectif, dans ce cas il est immédiat)
**IMAX**   |3 car. unité = ampères | Intensité maximale
PAPP       |5 car. unité = Volt.ampères | Puissance apparente : PAPP
HHPHC      |1 car.                 | Groupe horaire si option = heures creuses ou tempo
MOTDETAT   |6 car.                 | Mot d&#8217;état (autocontrôle) ||</span></a></p>
<p>!! Three phase specific data
If you have a 3-phase install, you will have more informations:
* iinst1, iinst2,iinst3 instead of iinst
* imax1, imax2, imax3 instaed of imax</p>
<p>If you use more than provided power on one phase, the information sent by teleinfo will change, and you will receive message using the schema teleinfo.short with only a few information :
* ADIR1, ADIR2, ADIR3 : intensity overload on each phase
* IINST1, IINST2, IINST3 : intensity on each phase.
!Developper notes
!!xPL schema
See the ((xPL_teleinfo_schema|xPL Teleinfo Schema page))</p>


          </div>         
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3>Browse</h3>
  <ul>
    
      <li>Prev: <a href="../plcbus/index.html">&lt;no title&gt;</a></li>
    
    
      <li>Next: <a href="../wol_ping/index.html">&lt;no title&gt;</a></li>
    
  </ul>
  <h3>You are here:</h3>
  <ul>
      <li>
        <a href="../../index.html">Domogik 0.1 documentation</a>
        
        <ul><li>&lt;no title&gt;</li></ul>
        
      </li>
  </ul>  

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/plugins/teleinfo/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
          </div> 
        
      
    </div>
    
    <div id="ft">
      <div class="nav">
    &laquo; <a href="../plcbus/index.html" title="&amp;lt;no title&amp;gt;">previous</a> 
     |
    <a title="Domogik 0.1 documentation" href="../../index.html" accesskey="U">up</a>
   |
    <a href="../wol_ping/index.html" title="&amp;lt;no title&amp;gt;">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>