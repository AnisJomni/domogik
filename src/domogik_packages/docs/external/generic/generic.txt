=============================
External member documentation
=============================

Purpose
=======
This external member is dedicated to be used by everyone with a xPL client (DIY or commercial product). It allows to use some generic features (temperature, teleinfo, ...) without needing to create a dedicated external member for the xPL client.


Temperature
===========

Features
--------

* temperature

xPL message
-----------

The temperature feature is related to the **sensor.basic** message: 

* xpl-stat or xpl-trig: ::

    sensor.basic
    {
    type=temp
    device=<device address>
    current=<value>
    }

Humidity
========

Features
--------

* humidity

xPL message
-----------

The humidity feature is related to the **sensor.basic** message: 

* xpl-stat or xpl-trig: ::

    sensor.basic
    {
    type=humidity
    device=<device address>
    current=<value>
    }

Pressure
========

Features
--------

* pressure

xPL message
-----------

The pressure feature is related to the **sensor.basic** message:

* xpl-stat or xpl-trig: ::

    sensor.basic
    {
    type=pressure
    device=<device address>
    current=<value>
    }

Teleinfo
========

Features
--------

* Max power
* Instant power
* Off peak hours
* Peak hours
* Tariff period
* Apparent power
* Hourly group
* Instant power 1
* Instant power 2
* Instant power 3
* Max power 1
* Max power 2
* Max power 3

xPL Message
-----------

* xpl-stat: ::

    TELEINFO.BASIC
    {
    ADCO=<Adresse du compteur>
    OPTARIF=<Option tarifaire>
    ISOUSC=<Intensité souscrite>
    BASE=<Index option base>
    IINST=<Intensité instantanée>
    IMAX=<Intensité maximale appelée>
    MOTDETAT=<Mot d'état du compteur>
    [HCHC=<Heures|creuses>]
    [HCHP=<Heures|pleines>]
    [EJPHN=<Heures|normales>]
    [EJPHPM=<Heures|de pointe>]
    [BBRHCJB=<Heures|creuses jours bleus>]
    [BBRHPJB=<Heures|pleines jours bleus>]
    [BBRHCJW=<Heures|creuses jours blancs>]
    [BBRHPJW=<Heures|pleines jours blancs>]
    [BBRHCJR=<Heures|creuses jours rouges>]
    [BBRHPJR=<Heures|pleines jours rouges>]
    [PEJP=<Préavis|début EJP (30min)>]
    [PTEC=<Période|tarifaire actuelle>]
    [DEMAIN=<Couleur|du lendemain>]
    [ADPS=<Avertissement|de dépassement>]
    [PAPP=<Puissance|apparente>]
    [HHPHC=<Horaire|heure pleine/heure creuse>]
    [PPOT=<Présence|des potentiels>]
    [IINST1=<Intensité|instantanée phase 1>]
    [IINST2=<Intensité|instantanée phase 2>]
    [IINST3=<Intensité|instantanée phase 3>]
    [IMAX1=<Intensité|maximale phase 1>]
    [IMAX2=<Intensité|maximale phase 2>]
    [IMAX3=<Intensité|maximale phase 3>]
    [PMAX=<Puissance|maximale triphasée>]
    }


    TELEINFO.BASIC
    {
    ADIR1=<Dépassement d'intensité sur la phase 1>
    ADIR2=<Dépassement d'intensité sur la phase 2>
    ADIR3=<Dépassement d'intensité sur la phase 3>
    ADCO=<Adresse du compteur>
    IINST1=<Intensité instantanée phase 1>
    IINST2=<Intensité instantanée phase 2>
    IINST3=<Intensité instantanée phase 3>
    }


Tank level
==========

Features
--------

* level (%)
* distance (distance between the level and the top of the tank)

xPL message
-----------

The **level** feature is related to the **sensor.basic** message:

* xpl-stat or xpl-trig: ::

    sensor.basic
    {
    type=percent
    device=<device address>
    current=<value>
    }

The **distance** feature is related to the **sensor.basic** message:

* xpl-stat or xpl-trig: ::

    sensor.basic
    {
    type=distance
    device=<device address>
    current=<value>
    }

RGB leds
========

Features
--------

* color (set the leds color)
* switch (switch on/off the leds)

xPL message
-----------

The **color** and **switch** features are related to the **arduino.rgb** message:

* xpl-cmnd: ::

    arduino.rgb
    {
    device=<device address>
    command=setcolor
    color=<value>
    }

  The Values for **color** can be :

  * on : to switch on the leds
  * off : to switch off the leds
  * #ffffff : a RGB color code to set a color (if off, this should also switch on the leds)

* xpl-stat or xpl-trig: ::

    arduino.rgb
    {
    device=<device address>
    command=setcolor
    color=<value>
    }

  The Values for **color** can be :

  * off : to switch off the leds
  * #ffffff : a RGB color code to set a color (if off, this should also switch on the leds)

  Notice that there is no **on** value for color as when the leds are switched on, we assume the color code is sent as the color value.









Creating devices for generic
-----------------------------
In administration, go to Organization > Devices page to create your devices.

Feature 1
*********

.. todo:: 
    Update the screenshot
    Describe the data to set in each field of the device creation box

.. |example_feature1| image:: example_feature1.png
    :width: 200px

+--------------------+-------------------+--------------------------------------------------------------------------------------------+
| Example            | Key               | Description                                                                                |
+====================+===================+============================================================================================+
| |example_feature1| | Name              | The name you want to give to the device : ...                                              |
|                    +-------------------+--------------------------------------------------------------------------------------------+
|                    | Address           | The device address : ...                                                                   |
|                    |                   | Example for ... : ...                                                                      |
|                    |                   |                                                                                            |
|                    |                   | .. todo::                                                                                  |
|                    |                   |     For some packages, you need to use a helper command to get the devices addresses.      |
|                    |                   |     If this is the case, mention it here.                                                  |
|                    +-------------------+--------------------------------------------------------------------------------------------+
|                    | Feature           | xxx.yyy                                                                                    |
|                    +-------------------+--------------------------------------------------------------------------------------------+
|                    | Usage             | An appropriate usage (...)                                                                 |
|                    +-------------------+--------------------------------------------------------------------------------------------+
|                    | Description       | Whatever you want                                                                          |
|                    +-------------------+--------------------------------------------------------------------------------------------+
|                    | Reference         | Whatever you want                                                                          |
+--------------------+-------------------+--------------------------------------------------------------------------------------------+


