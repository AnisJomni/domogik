
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>&lt;no title&gt; &mdash; Domogik 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Domogik 0.1 documentation" href="../../index.html" />
    <link rel="next" title="&lt;no title&gt;" href="../mirror/index.html" />
    <link rel="prev" title="Plugin CIDmodem" href="../cidmodem/index.html" /> 
  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Domogik 0.1 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
      </div>
      <div class="nav">
    &laquo; <a href="../cidmodem/index.html" title="Plugin CIDmodem">previous</a> 
     |
    <a title="Domogik 0.1 documentation" href="../../index.html" accesskey="U">up</a>
   |
    <a href="../mirror/index.html" title="&amp;lt;no title&amp;gt;">next</a> &raquo;</div>
    </div>
    
    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="plugins-ipx800-index">
            
  <p>!Plugin ipx800
{maketoc}</p>
<p>!!Purpose
The IPX800 is a &#8220;web relay board&#8221; : a relay bord which can be controlled with a web interface. It can be plugged on a network, so you can access and control it from your browser.</p>
<p>{IMG(attId=&#8221;272&#8221;)}{IMG}</p>
<p>This board exists in several version with different features :
* IPX 800 : <a class="reference external" href="http://www.gce-electronics.com/tcp-ip/18-serveur-ip-8-relais-ethernet.html">http://www.gce-electronics.com/tcp-ip/18-serveur-ip-8-relais-ethernet.html</a>
* IPX 800 pro : <a class="reference external" href="http://www.gce-electronics.com/tcp-ip/31-serveur-ip-8-relais-ethernet.html">http://www.gce-electronics.com/tcp-ip/31-serveur-ip-8-relais-ethernet.html</a>
* IPX 800 v2.0 : <a class="reference external" href="http://www.gce-electronics.com/40-ipx800-v200.html">http://www.gce-electronics.com/40-ipx800-v200.html</a></p>
<p>This plugin handle the following features :
* relays usage and status
* digitial input status
* analog input status
* counter status (and in a futur release, counter reset)</p>
<p>!!Known issues
!!!HTTP Authentication make plugin slower
Using HTTP authentication make plugin interactions with relay board slower. If it is not necessary for you, avoid using HTTP authentication.</p>
<p>!!How to plug
The IPX relay board has just to be put in your Local Area Network.
{IMG(attId=&#8221;64&#8221;)}{IMG}</p>
<p>!!Plugin configuration
!!!Enabling plugin
You can enable plugin by using :
{CODE()}
dmgenplug ipx800
{CODE}</p>
<p>You just have to reload administration page to see the plugin in the list.</p>
<p>!!!Configuration
In Domogik administration, go to ipx800 configuration page.</p>
<p>!!!!name
Name for the IPX800. This name will be used when you will create devices for your inputs or relays. Example with &#8220;ipx&#8221; name:
* relay 0 (0..7) : &#8220;ipx-led0&#8221;
* digital input 2 (0..3) : &#8220;ipx-btn2&#8221;
* analog input 1 (1..2) : &#8220;ipx-an1&#8221;
* counter 3 (0..3) : &#8220;ipx-count3&#8221;</p>
<p>!!!!ip
Ip of the IPX800. To find all availables IPX800 relay boards on network, you can use the <strong>ipx800 find</strong> helper.</p>
<p>!!!!int
Interval between each reading of IPX800 status
Default : 5</p>
<p>!!!!login (optionnal)
Login for HTTP authentication.</p>
<p>!!!!password (optionnal)
Password for HTTP authentication.</p>
<p>!!!Start plugin
You can now start the plugin (start button).</p>
<p>!!Creating devices for IPX800
In administration, go to Organization &gt; Devices page to create your devices.</p>
<p>!!!Relay
Create a new device like this :</p>
<ul class="simple">
<li>Name : &#8220;IPX Relay 0&#8221; (or whatever you want)</li>
<li>Description : a short description (Placement, usage, etc)</li>
<li>Address : &lt;ipx name&gt;-led&lt;0..7&gt;. <strong>ipx name</strong> is defined by you in plugin configuration. <strong>0..7</strong> is the relay number. So, if your board name is &#8220;myipx&#8221; and you want to create a device for the first relay, you should put : <strong>myipx-led0</strong></li>
<li>Reference : &#8220;IPX800&#8221; (or whatever you want)</li>
<li>Usage : &#8220;Appliance&#8221;, &#8220;Light&#8221; (for example)</li>
<li>Type : RelayBoard.Relay</li>
</ul>
<p>((Setup_your_devices|Attribute the feature to a place and you can now see the status of your IPX800 board relay (on or off)))</p>
<p>Example :</p>
<p>{IMG(attId=&#8221;184&#8221;)}{IMG}</p>
<p>!!!Digital input
Create a new device like this :</p>
<ul class="simple">
<li>Name : &#8220;IPX Digital Input 0&#8221; (or whatever you want)</li>
<li>Description : a short description (Placement, usage, etc)</li>
<li>Address : &lt;ipx name&gt;-btn&lt;0..3&gt;. <strong>ipx name</strong> is defined by you in plugin configuration. <strong>0..3</strong> is the digital input number. So, if your board name is &#8220;myipx&#8221; and you want to create a device for the first digital input, you should put : <strong>myipx-btn0</strong></li>
<li>Reference : &#8220;IPX800&#8221; (or whatever you want)</li>
<li>Usage : &#8220;Shutter&#8221; (for example)</li>
<li>Type : RelayBoard.Digital_Input</li>
</ul>
<p>Example :</p>
<p>{IMG(attId=&#8221;185&#8221;)}{IMG}</p>
<p>((Setup_your_devices|Attribute the feature to a place and you can now see the status of your IPX800 board digital input (up or down)))</p>
<p>!!!Analog input
Create a new device like this :</p>
<ul class="simple">
<li>Name : &#8220;IPX Analog Input 1&#8221; (or whatever you want)</li>
<li>Description : a short description (Placement, usage, etc)</li>
<li>Address : &lt;ipx name&gt;-an&lt;1..2&gt;. <strong>ipx name</strong> is defined by you in plugin configuration. <strong>1..2</strong> is the analog input number. So, if your board name is &#8220;myipx&#8221; and you want to create a device for the first analog input, you should put : <strong>myipx-an1</strong></li>
<li>Reference : &#8220;IPX800&#8221; (or whatever you want)</li>
<li>Usage : &#8220;Electricity&#8221; (for example)</li>
<li>Type : RelayBoard.Analog_Input</li>
</ul>
<p><em>Notice that for relay and digital input, number of item start at &#8216;0&#8217; and for analog input, it starts to &#8216;1&#8217;. It is due to IPX800 design.</em></p>
<p>Example :</p>
<p>{IMG(attId=&#8221;186&#8221;)}{IMG}</p>
<p>((Setup_your_devices|Attribute the feature to a place and you can now see the value of your IPX800 board analog input.))</p>
<p>!!!Counter
<strong>Warning</strong> : counter are not well ordered in IPX800 firmware :
* count1 =&gt; btn3
* count2 =&gt; btn2
* count3 =&gt; btn1
* count4 =&gt; btn0</p>
<p>Create a new device like this :</p>
<ul class="simple">
<li>Name : &#8220;IPX Counter 0&#8221; (or whatever you want)</li>
<li>Description : a short description (Placement, usage, etc)</li>
<li>Address : &lt;ipx name&gt;-count&lt;0..3&gt;. <strong>ipx name</strong> is defined by you in plugin configuration. <strong>0..3</strong> is the counter number. So, if your board name is &#8220;myipx&#8221; and you want to create a device for the first counter, you should put : <strong>myipx-count0</strong></li>
<li>Reference : &#8220;IPX800&#8221; (or whatever you want)</li>
<li>Usage : &#8220;Water&#8221;(for example)</li>
<li>Type : RelayBoard.Counter</li>
</ul>
<p>Example :</p>
<p>{IMG(attId=&#8221;187&#8221;)}{IMG}</p>
<p>((Setup_your_devices|Attribute the feature to a place and you can now see the count of your IPX800 board counter.))</p>
<p>!!Helpers
<em>To get an introduction to helpers, you can read the ((Plugins_helpers|Helper documentation)). To use a helper, the plugin must be stopped.</em></p>
<p>!!!ipx800 find
<strong>ipx800 find</strong> helper will discover all available IPX800 boards on network.</p>
<p>{CODE()}
$ ipx800 find
List of all IPX800 boards found :
192.168.0.102 : IPX800
192.168.0.103 : RELAYBOARD
{CODE}</p>
<p>!!!ipx800 status &lt;board ip&gt; &lt;login (optionnal)&gt; &lt;password (optionnal)&gt;
<strong>ipx800 status &lt;board ip&gt; &lt;login&gt; &lt;password&gt;</strong> helper will give you status of board&#8217;s elements.</p>
<p>{CODE()}
$ ipx800 status 192.168.0.102 admin pass
List of relay :
- led0 : 0
- led1 : 0
...
List of digital input :
- btn0 : up
- btn1 : up
...
List of analog input :
- an1 : 0
- an2 : 0
List of counters :
- count0 : 5
- count1 : 47
{CODE}</p>
<p>!!Upgrade IPX800 firmware
1. Go on [<a class="reference external" href="http://www.gce-electronics.com/">http://www.gce-electronics.com/</a><a href="#id1"><span class="problematic" id="id2">|</span></a>GCE Electronics website]
2. Go to your IPX800 model page. Click on &#8220;Télécharger&#8221; on bottom to see all availables downloads :
{IMG(attId=&#8221;275&#8221;)}{IMG}
3. Download the latest release
4. Extract it :
{CODE()}
$ mkdir /tmp/ipx800
$ cd /tmp/ipx800
$ unrar e &#8220;/path/to/IPX800 V2 3.xx.xx.rar&#8221;
{CODE}</p>
<p>5. Download the linux utility to flash the IPX800 firmware :
{ATTACH(name=&#8221;flash.sh&#8221;,file=&#8221;flash.sh&#8221;,id=&#8221;276&#8221;,dls=&#8221;1&#8221;,icon=&#8221;1&#8221;)}{ATTACH}
Notice that this script is also available in Domogik sources in this path : <strong>src/tools/ipx800/flash.sh</strong>.
6. Launch utility like this :
{CODE()}
$ ./flash.sh /path/to/IPX800 V2 3.xx.xx/Flash/gceip3xxxx.hex
{CODE}
Follow script instructions</p>
<p>If everything went fine, you should obtain this kind of output :
{CODE()}
$ ./flash.sh gceip30021.hex
You are about to update IPX800 board with this firmware :
- gceip30021.hex
[Enter] to continue. [ctrl]-[c] to abort.</p>
<p>Manual operations to do before hitting [enter] to flash board :
1. Check your computer ip is on 192.168.1.x network
2. Unplug board.
3. Wait a few minutes.
4. While plug in board, press [enter]</p>
<p>Start updating...
tftp&gt; Sent 283047 bytes in 16.5 seconds
{CODE}</p>
<p>!!Make a hard reset on IPX800 firmware
A hard reset will make IPX800 relayboard going back to default settings (DHCP enabled, etc). To do this, just follow these steps :
1. Unplug Ipx800 board
2. Connect J2&#8217;s up pin and J92&#8217;s left pin together (see red pins in picture)
{IMG(attId=&#8221;274&#8221;)}{IMG}
3. Plug IPX800 board
4. Wait for relays clacking
5. Disconnect J2 and J92 pins
6. Unplug board
7. Plug board</p>
<p>!!Upgrade IPX800 website
1. Go on <strong>http://ipx800/mpfsupload/</strong> (assuming ipx800 is associated to your ipx800 IP address).
{IMG(attId=&#8221;273&#8221;)}{IMG}
2. Choose website package to upload.
3. Click on upload</p>
<p>Your IPX800&#8217;s website is updated.</p>
<p>!!Developper notes
!!!Finding an IPX relay board
TO discover all IPX relay boards on local network, you can send the following message on UDP (port 30303) :
{CODE()}
Discovery: Who is out there?
{CODE}</p>
<p>All IPX relay boards will answser
{CODE()}
&lt;name of relay board&gt;
&lt;mac address of relay board&gt;
{CODE}</p>
<p>!!!Get actual card status
You can get the actual status of the card with this url : <a class="reference external" href="http://ip:port/status.xml">http://ip:port/status.xml</a></p>
<p>This will give this xml data :</p>
<p>{CODE()}
&lt;response&gt;
&lt;led0&gt;0&lt;/led0&gt;
&lt;led1&gt;1&lt;/led1&gt;
&lt;led2&gt;1&lt;/led2&gt;
&lt;led3&gt;0&lt;/led3&gt;
&lt;led4&gt;1&lt;/led4&gt;
&lt;led5&gt;0&lt;/led5&gt;
&lt;led6&gt;0&lt;/led6&gt;
&lt;led7&gt;0&lt;/led7&gt;
&lt;btn0&gt;up&lt;/btn0&gt;
&lt;btn1&gt;up&lt;/btn1&gt;
&lt;btn2&gt;up&lt;/btn2&gt;
&lt;btn3&gt;up&lt;/btn3&gt;
&lt;an1&gt;81&lt;/an1&gt;
&lt;an2&gt;0&lt;/an2&gt;
&lt;time0&gt;07:40:19&lt;/time0&gt;
&lt;count1&gt;0&lt;/count1&gt;            # beta feature on IPX
&lt;count2&gt;0&lt;/count2&gt;            #
&lt;count3&gt;0&lt;/count3&gt;            #
&lt;count4&gt;0&lt;/count4&gt;            #
&lt;/response&gt;
{CODE}
* ledX : status of each relay (0 =&gt; OFF, 1 =&gt; ON)
* btnX : status of each digital input (up =&gt; ON, down =&gt; OFF)
* anX : value of each analog input (0 for 0V, 1024 for 3.3V)
* countX : value of each counter (0...)</p>
<p>!!!API
!!!!Change the relay state
Calling this url will change a relay state
<a class="reference external" href="http://ip:port/leds.cgi?led=N">http://ip:port/leds.cgi?led=N</a>  (N=0..7)</p>
<p>Example :
* change relay 0 state : <a class="reference external" href="http://ip:port/leds.cgi?led=0">http://ip:port/leds.cgi?led=0</a>
* change relay 2 state : <a class="reference external" href="http://ip:port/leds.cgi?led=2">http://ip:port/leds.cgi?led=2</a></p>
<p>!!!!Send a pulse to the relay
Calling this url will send a pulse to the relay
<a class="reference external" href="http://ip:port/rlyfs.cgi?rlyf=N">http://ip:port/rlyfs.cgi?rlyf=N</a>  (N=0..7)</p>
<p>Example :
* send a pulse to  relay 0 : <a class="reference external" href="http://ip:port/rlyfs.cgi?rlyf=0">http://ip:port/rlyfs.cgi?rlyf=0</a>
* send a pulse to  relay 2 : <a class="reference external" href="http://ip:port/rlyfs.cgi?rlyf=2">http://ip:port/rlyfs.cgi?rlyf=2</a></p>
<p>Note : sending a pulse to a relay that is already in state 1, will only put it to state 0 after pulse duration</p>
<p>!!!!Reset counter  &#8211; beta feature on IPX
Calling this url will reset a counter :
<a class="reference external" href="http://ip:port/counter.cgi?count=N">http://ip:port/counter.cgi?count=N</a> (N=0..3)</p>
<p>Example :
* Reset counter 0 : <a class="reference external" href="http://ip:port/counter.cgi?count=0">http://ip:port/counter.cgi?count=0</a>
* Reset counter 2 : <a class="reference external" href="http://ip:port/counter.cgi?count=2">http://ip:port/counter.cgi?count=2</a></p>
<p>!!!!/command
Here are the url to use for each feature of IPX800 board. &#8220;address&#8221; is &lt;boardname&gt;-&lt;element type (led, btn...)&gt;&lt;number of element&gt;</p>
<p>Switch :
* /command/relayboard/&lt;address&gt;/high
* /command/relayboard/&lt;address&gt;/low
Trigger :
* /command/relayboard/&lt;address&gt;/pulse</p>
<p>||TODO : reset counter when implemented||</p>
<p>!!!xPL Schema
!!!!xpl-cmnd
The COMMAND.BASIC xPL schema is used in this module : <a class="reference external" href="http://xplproject.org.uk/wiki/index.php?title=Schema_-_CONTROL.BASIC">http://xplproject.org.uk/wiki/index.php?title=Schema_-_CONTROL.BASIC</a></p>
<p>{CODE()}
CONTROL.BASIC
{
DEVICE=&lt;device name&gt;
TYPE=&lt;device type&gt;
CURRENT=&lt;value sent to the device&gt;
}
{CODE}
* device : &lt;relay board name in plugin config&gt;-&lt;element : btn0, btn1...&gt;
* type :
** output for a relay
** count for the counter
* current :
** HIGH, LOW, PULSE for a relay
** 0 to reset counter</p>
<p>!!!!xpl-stat
There is no usage of xpl-stat with this plugin</p>
<p>!!!!xpl-trig
The SENSOR.BASIC xPL schema is used in this module : <a class="reference external" href="http://xplproject.org.uk/wiki/index.php?title=Schema_-_SENSOR.BASIC">http://xplproject.org.uk/wiki/index.php?title=Schema_-_SENSOR.BASIC</a></p>
<p>{CODE()}
SENSOR.BASIC
{
DEVICE=&lt;device name&gt;
TYPE=&lt;device type&gt;
CURRENT=&lt;current value&gt;
}
{CODE}
* device : &lt;relay board name in plugin config&gt;-&lt;element : btn0, btn1...&gt;
* type :
** output for a relay
** input for the digital input
** voltage for the analog input
** count for the counter
* current :
** HIGH, LOW for a relay (there is no PULSE value here)
** 0 to reset counter</p>
<p>A xpl-trig message is sent at each status change for board&#8217;s elements.</p>


          </div>         
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3>Browse</h3>
  <ul>
    
      <li>Prev: <a href="../cidmodem/index.html">Plugin CIDmodem</a></li>
    
    
      <li>Next: <a href="../mirror/index.html">&lt;no title&gt;</a></li>
    
  </ul>
  <h3>You are here:</h3>
  <ul>
      <li>
        <a href="../../index.html">Domogik 0.1 documentation</a>
        
        <ul><li>&lt;no title&gt;</li></ul>
        
      </li>
  </ul>  

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/plugins/ipx800/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
          </div> 
        
      
    </div>
    
    <div id="ft">
      <div class="nav">
    &laquo; <a href="../cidmodem/index.html" title="Plugin CIDmodem">previous</a> 
     |
    <a title="Domogik 0.1 documentation" href="../../index.html" accesskey="U">up</a>
   |
    <a href="../mirror/index.html" title="&amp;lt;no title&amp;gt;">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>