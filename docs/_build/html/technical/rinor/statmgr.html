
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Statistics Manager &mdash; Domogik 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Domogik 0.1 documentation" href="../../index.html" />
    <link rel="next" title="REST /base" href="rest_base.html" />
    <link rel="prev" title="RINOR Overview" href="index.html" /> 
  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Domogik 0.1 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="RINOR Overview">previous</a> 
     |
    <a title="Domogik 0.1 documentation" href="../../index.html" accesskey="U">up</a>
   |
    <a href="rest_base.html" title="REST /base">next</a> &raquo;</div>
    </div>
    
    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="technical-rinor-statmgr">
            
  <div class="section" id="statistics-manager">
<h1>Statistics Manager<a class="headerlink" href="#statistics-manager" title="Permalink to this headline">¶</a></h1>
<p>Stats manager&#8217;s goal is to store in database interesting data he can read on xPL network. To know which data should be stored, some XML files are used.</p>
<div class="section" id="adding-new-statistics-in-database">
<h2>Adding new statistics in database<a class="headerlink" href="#adding-new-statistics-in-database" title="Permalink to this headline">¶</a></h2>
<div class="section" id="xml-files">
<h3>XML files<a class="headerlink" href="#xml-files" title="Permalink to this headline">¶</a></h3>
<p>In order Stats Manager to know which data from xPL network to store in database and how to store it, XML files are used.
These files are read by statmgr and define which xPL messages to listen and which data in these messages have to be store</p>
<div class="section" id="folder-hierarchy-for-xml-files">
<h4>Folder hierarchy for XML files<a class="headerlink" href="#folder-hierarchy-for-xml-files" title="Permalink to this headline">¶</a></h4>
<p>Here is the structure choosen to store xml files : &lt;xml folder for statmgr&gt;/&lt;Technology&gt;/&lt;xplSchema&gt;.xml</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x10</span><span class="o">/</span><span class="n">x10</span><span class="o">.</span><span class="n">basic</span><span class="o">.</span><span class="n">xml</span>
<span class="n">computer</span><span class="o">/</span><span class="n">sensor</span><span class="o">.</span><span class="n">basic</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-new-xml-file">
<h4>Adding a new xml file<a class="headerlink" href="#adding-a-new-xml-file" title="Permalink to this headline">¶</a></h4>
<p>Xml files are provided by plugins. A plugin has to provide a file for each xpl message type. ^
So, several plugins can provide the same xml files. This problem is solved at plugin installation :</p>
<ul>
<li><p class="first">plugin installation lists plugin&#8217;s xml files provided</p>
</li>
<li><p class="first">plugin installation lists statmgr&#8217;s xml files already installed</p>
</li>
<li><p class="first">if there is a conflict (xml files already exists) :</p>
<blockquote>
<div><ul class="simple">
<li>tell user that there is a conflict</li>
<li>display a diff of the 2 (or more) conflicted files</li>
<li>ask user to choose one file (default : the file already installed)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">plugin installation installs xml files and continue his installation</p>
</li>
</ul>
</div>
<div class="section" id="xml-file-description">
<h4>Xml file description<a class="headerlink" href="#xml-file-description" title="Permalink to this headline">¶</a></h4>
<p>A xml file for statmgr defines :</p>
<ul class="simple">
<li>a listener for the xpl schema</li>
<li>a mapping for the listener between xpl schema elements and database</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="c">&lt;!-- All xml definition files must be in &lt;domogik.cfg_path&gt;/xml directory,</span>
<span class="c">    one mapping definintion per file.</span>
<span class="c">--&gt;</span>
<span class="c">&lt;!-- statistic : root element</span>
<span class="c">attribute technology is mandatory</span>
<span class="c">It specifies the technology for which this mapping is used.</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;statistic</span> <span class="na">technology=</span><span class="s">&quot;plcbus&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;schema</span> <span class="na">name=</span><span class="s">&quot;control.basic&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xpltype</span> <span class="na">type=</span><span class="s">&quot;xpl-trig&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;listener&gt;</span>
                <span class="nt">&lt;filter&gt;</span>
                    <span class="c">&lt;!-- list of &#39;key&#39; nodes.</span>
<span class="c">                    each node must have 2 parameters :</span>
<span class="c">                        - name : the &quot;key&quot; of the pair</span>
<span class="c">                        - command : the &quot;value&quot; of the pair</span>
<span class="c">                        A message will be loggued only if schema and xpltype are corrects,</span>
<span class="c">                        and only if for all &quot;key&quot; nodes specified, there is a name=value pair in the message.</span>
<span class="c">                    --&gt;</span>
                    <span class="nt">&lt;key</span> <span class="na">name=</span><span class="s">&quot;type&quot;</span> <span class="na">value=</span><span class="s">&quot;plcbus&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;key</span> <span class="na">name=</span><span class="s">&quot;command&quot;</span> <span class="na">value=</span><span class="s">&quot;on&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/filter&gt;</span>
            <span class="nt">&lt;/listener&gt;</span>
            <span class="nt">&lt;mapping&gt;</span> <span class="c">&lt;!-- define the mapping between message keys and the database --&gt;</span>
                <span class="nt">&lt;device</span> <span class="na">field=</span><span class="s">&quot;device&quot;</span><span class="nt">/&gt;</span>
                <span class="c">&lt;!-- define the field containing device name/address</span>
<span class="c">                     If there is no field containing device addres, you can use &#39;static_name&#39; attribute to define a name. Use with caution and only when there is no other choice :</span>
<span class="c">                     &lt;device static_name=&quot;foo&quot;/&gt;</span>
<span class="c">                     If it is a notification message, use this :</span>
<span class="c">                     &lt;device type=&quot;notification&quot;/&gt;</span>
<span class="c">                --&gt;</span>
                <span class="c">&lt;!-- The &quot;value&quot; node can have 2 attributes :</span>
<span class="c">                    - field : mandatory ! define the key of the pair key=value to get in the Xpl message</span>
<span class="c">                    - new_name: optionnal, if it&#39;s define, the &#39;name&#39; of this value entry will be the value defined,</span>
<span class="c">                            else it will be the filed name.</span>
<span class="c">                    - filter_key : define one key to read for adding a filter on renaming name in new_name</span>
<span class="c">                    - filter_value : the value for the filter</span>
<span class="c">                    - history_size : optionnal, indicate number of values to keep in database for a device key</span>
<span class="c">                --&gt;</span>
                <span class="nt">&lt;value</span> <span class="na">field=</span><span class="s">&quot;command&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;value</span> <span class="na">field=</span><span class="s">&quot;command&quot;</span> <span class="na">history_size=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;value</span> <span class="na">field=</span><span class="s">&quot;command&quot;</span> <span class="na">new_name=</span><span class="s">&quot;bar&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;value</span> <span class="na">field=</span><span class="s">&quot;command&quot;</span> <span class="na">new_name=</span><span class="s">&quot;foo&quot;</span> <span class="na">filter_key=</span><span class="s">&quot;type&quot;</span> <span class="na">filter_value=</span><span class="s">&quot;plcbus&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/mapping&gt;</span>
        <span class="nt">&lt;/xpltype&gt;</span>
        <span class="nt">&lt;xpltype</span> <span class="na">type=</span><span class="s">&quot;xpl-stat&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;listener&gt;</span>
                <span class="nt">&lt;filter&gt;</span>
                    <span class="nt">&lt;key</span> <span class="na">name=</span><span class="s">&quot;type&quot;</span> <span class="na">value=</span><span class="s">&quot;plcbus&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;key</span> <span class="na">name=</span><span class="s">&quot;command&quot;</span> <span class="na">value=</span><span class="s">&quot;off&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/filter&gt;</span>
            <span class="nt">&lt;/listener&gt;</span>
            <span class="nt">&lt;mapping&gt;</span> <span class="c">&lt;!-- define the mapping between message keys and the database --&gt;</span>
                <span class="nt">&lt;device</span> <span class="na">field=</span><span class="s">&quot;device&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- define the device name --&gt;</span>
                <span class="nt">&lt;value</span> <span class="na">field=</span><span class="s">&quot;command&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;value</span> <span class="na">field=</span><span class="s">&quot;command&quot;</span> <span class="na">name=</span><span class="s">&quot;bar&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/mapping&gt;</span>
        <span class="nt">&lt;/xpltype&gt;</span>
    <span class="nt">&lt;/schema&gt;</span>
<span class="nt">&lt;/statistic&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If xpl-trig and xpl-stat parts are identical, you can use <strong>type=&#8221;*&#8221;</strong></p>
</div>
<p>Example for x10/x10.basic:</p>
<div class="highlight-python"><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;statistic technology="x10"&gt;
    &lt;schema name="x10.basic"&gt;
        &lt;xpltype type="xpl-trig"&gt;
            &lt;listener&gt;
                &lt;filter/&gt;
            &lt;/listener&gt;
            &lt;mapping&gt;
                &lt;device field="device"/&gt;
                &lt;value field="command"/&gt;
                &lt;value field="level" /&gt;
            &lt;/mapping&gt;
        &lt;/xpltype&gt;
    &lt;/schema&gt;
&lt;/statistic&gt;</pre>
</div>
</div>
</div>
</div>
<div class="section" id="flow">
<h2>Flow<a class="headerlink" href="#flow" title="Permalink to this headline">¶</a></h2>
<p>To see flow about statistics and events, see <a class="reference internal" href="rest_events.html"><em>events page</em></a>.</p>
</div>
<div class="section" id="developper-notes">
<h2>Developper notes<a class="headerlink" href="#developper-notes" title="Permalink to this headline">¶</a></h2>
<p>Stats manager read all xml files. for each files, it create listeners. Each listener will call a callback function that put data in database with good format.</p>
</div>
</div>


          </div>         
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Statistics Manager</a><ul>
<li><a class="reference internal" href="#adding-new-statistics-in-database">Adding new statistics in database</a><ul>
<li><a class="reference internal" href="#xml-files">XML files</a><ul>
<li><a class="reference internal" href="#folder-hierarchy-for-xml-files">Folder hierarchy for XML files</a></li>
<li><a class="reference internal" href="#adding-a-new-xml-file">Adding a new xml file</a></li>
<li><a class="reference internal" href="#xml-file-description">Xml file description</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#flow">Flow</a></li>
<li><a class="reference internal" href="#developper-notes">Developper notes</a></li>
</ul>
</li>
</ul>

  <h3>Browse</h3>
  <ul>
    
      <li>Prev: <a href="index.html">RINOR Overview</a></li>
    
    
      <li>Next: <a href="rest_base.html">REST /base</a></li>
    
  </ul>
  <h3>You are here:</h3>
  <ul>
      <li>
        <a href="../../index.html">Domogik 0.1 documentation</a>
        
        <ul><li>Statistics Manager</li></ul>
        
      </li>
  </ul>  

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/technical/rinor/statmgr.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
          </div> 
        
      
    </div>
    
    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="RINOR Overview">previous</a> 
     |
    <a title="Domogik 0.1 documentation" href="../../index.html" accesskey="U">up</a>
   |
    <a href="rest_base.html" title="REST /base">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>